#!/bin/zsh

# Check if a title argument is provided
if [ -z "$1" ]; then
    echo "Error: A file name must be set, e.g. og \"the wonderful thing about tiggers\"."
    exit 1
fi

# Determine if the first argument is a mode or a title
if [ "$1" = "-s" ] || [ "$1" = "--struct" ]; then
    if [ -z "$2" ]; then
        echo "Error: A title must be set when using the -s or --struct option."
        exit 1
    fi
    mode="$1"
    title="$2"
else
    mode=""
    title="$1"
fi

INBOX_NAME="11 INBOX"

# Format the file name with the current date and replace spaces with hyphens
sanitized_file_name=$(echo "$title" | tr -cd 'a-zA-Z0-9 ' | tr ' ' '_')
formatted_file_name=$(date "+%Y%m%d")_${sanitized_file_name}

echo $formatted_file_name

# Change to the OBSIDIAN_ROOT directory
cd "$OBSIDIAN_ROOT" || { echo "Error: OBSIDIAN_ROOT directory not found."; exit 1; }

if [ "$mode" = "-s" ] || [ "$mode" = "--struct" ]; then
    # Create the folder and the file inside it
    folder_path="${INBOX_NAME}/${formatted_file_name}"
    mkdir -p "$folder_path" || { echo "Error: Failed to create directory $folder_path."; exit 1; }
    file_path="${folder_path}/${formatted_file_name}.md"
else
    # Create the file directly in the $INBOX_NAME directory
    file_path="${INBOX_NAME}/${formatted_file_name}.md"
fi

# Create the new file in the "11 INBOX" subdirectory
touch "$file_path"

# Add the actual title to the file content
echo "# $title" > "$file_path"

# Open the file with nvim
nvim "$file_path"

